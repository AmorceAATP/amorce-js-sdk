{"version":3,"sources":["../src/index.ts","../src/exceptions.ts","../src/identity.ts","../src/envelope.ts","../src/client.ts","../src/models.ts"],"sourcesContent":["/**\n * Amorce SDK for JavaScript/TypeScript\n * Version 2.1.0\n * \n * Aligned with amorce-py-sdk v0.2.0\n */\n\nexport const SDK_VERSION = \"2.1.0\";\nexport const AATP_VERSION = \"0.1.0\";\n\n// Export Exception Classes\nexport * from './exceptions';\n\n// Export Identity Module (with Provider Pattern)\nexport * from './identity';\n\n// Export Envelope Module (Legacy/Future Use)\nexport * from './envelope';\n\n// Export Client Module\nexport * from './client';\n\n// Export Response Models (v2.1.0)\nexport * from './models';\n\nconsole.log(`Amorce JS SDK v${SDK_VERSION} loaded.`);","/**\n * Amorce Exceptions Module\n * Defines custom exceptions for the Amorce SDK to allow fine-grained error handling.\n * Matches the exception hierarchy from nexus-py-sdk v0.1.7\n */\n\n/**\n * Base class for all Amorce SDK exceptions.\n */\nexport class AmorceError extends Error {\n    constructor(message: string) {\n        super(message);\n        this.name = 'AmorceError';\n        // Maintains proper stack trace for where our error was thrown (only available on V8)\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        }\n    }\n}\n\n/**\n * Raised when there is a configuration issue (e.g. invalid URL, missing key).\n */\nexport class AmorceConfigError extends AmorceError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'AmorceConfigError';\n    }\n}\n\n/**\n * Raised when a network operation fails (e.g. connection timeout, DNS error).\n */\nexport class AmorceNetworkError extends AmorceError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'AmorceNetworkError';\n    }\n}\n\n/**\n * Raised when the Amorce API returns an error response (4xx, 5xx).\n */\nexport class AmorceAPIError extends AmorceError {\n    public statusCode?: number;\n    public responseBody?: string;\n\n    constructor(message: string, statusCode?: number, responseBody?: string) {\n        super(message);\n        this.name = 'AmorceAPIError';\n        this.statusCode = statusCode;\n        this.responseBody = responseBody;\n    }\n}\n\n/**\n * Raised when a security-related operation fails (e.g. signing, key loading).\n */\nexport class AmorceSecurityError extends AmorceError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'AmorceSecurityError';\n    }\n}\n\n/**\n * Raised when data validation fails (e.g. invalid envelope structure).\n */\nexport class AmorceValidationError extends AmorceError {\n    constructor(message: string) {\n        super(message);\n        this.name = 'AmorceValidationError';\n    }\n}\n","/**\n * Amorce Identity Module (Task 2.2 - Enhanced for v0.1.7)\n * Handles Ed25519 key management and signing using libsodium.\n * Compatible with both Browser and Node.js environments.\n * \n * v0.1.7 Updates:\n * - Added Provider Pattern for flexible key sources\n * - Added Agent ID derivation (SHA-256 of public key)\n * - Added canonical JSON helper\n * - Improved error handling with custom exceptions\n */\n\nimport sodium from 'libsodium-wrappers';\nimport { AmorceSecurityError } from './exceptions';\n\n/**\n * Abstract base class for retrieving private keys.\n */\nexport interface IdentityProvider {\n  getPrivateKey(): Promise<Uint8Array>;\n}\n\n/**\n * Loads a private key from an environment variable string.\n * Works in both Node.js and browser environments (if env vars are available).\n */\nexport class EnvVarProvider implements IdentityProvider {\n  private envVarName: string;\n\n  constructor(envVarName: string = 'AGENT_PRIVATE_KEY') {\n    this.envVarName = envVarName;\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    await sodium.ready;\n\n    // Try to get from process.env (Node.js) or globalThis (browser with webpack/vite)\n    let pemData: string | undefined;\n\n    if (typeof process !== 'undefined' && process.env) {\n      pemData = process.env[this.envVarName];\n    }\n\n    if (!pemData) {\n      throw new AmorceSecurityError(`Environment variable ${this.envVarName} is not set.`);\n    }\n\n    // Handle cases where newlines are escaped (common in some CI/CD)\n    pemData = pemData.replace(/\\\\n/g, '\\n');\n\n    try {\n      return this.pemToPrivateKey(pemData);\n    } catch (e) {\n      throw new AmorceSecurityError(`Failed to load key from environment variable: ${e}`);\n    }\n  }\n\n  private pemToPrivateKey(pem: string): Uint8Array {\n    // Extract base64 from PEM format\n    const b64 = pem\n      .replace('-----BEGIN PRIVATE KEY-----', '')\n      .replace('-----END PRIVATE KEY-----', '')\n      .replace(/\\s/g, '');\n\n    // Decode base64\n    const fullBytes = sodium.from_base64(b64, sodium.base64_variants.ORIGINAL);\n\n    // PKCS#8 format for Ed25519 has a 16-byte header, followed by 2-byte length prefix, then 32-byte key\n    // Total: 48 bytes (16 + 2 + 32), but we need to extract the 32-byte seed\n    if (fullBytes.length >= 48) {\n      // The seed starts at byte 16 (skip PKCS#8 header)\n      return fullBytes.slice(16, 48);\n    }\n\n    throw new AmorceSecurityError('Invalid private key format');\n  }\n}\n\n/**\n * Holds a generated key in memory (Ephemeral).\n * Internal provider used by the generate() factory method.\n */\nclass InMemoryProvider implements IdentityProvider {\n  private privateKey: Uint8Array;\n\n  constructor(privateKey: Uint8Array) {\n    this.privateKey = privateKey;\n  }\n\n  async getPrivateKey(): Promise<Uint8Array> {\n    return this.privateKey;\n  }\n}\n\n/**\n * Central class to manage the agent's identity.\n */\nexport class IdentityManager {\n  private privateKey: Uint8Array;\n  public publicKey: Uint8Array;\n\n  private constructor(privateKey: Uint8Array, publicKey: Uint8Array) {\n    this.privateKey = privateKey;\n    this.publicKey = publicKey;\n  }\n\n  /**\n   * Initializes from a provider (flexible key source).\n   */\n  static async fromProvider(provider: IdentityProvider): Promise<IdentityManager> {\n    await sodium.ready;\n    const privateKey = await provider.getPrivateKey();\n\n    // Extract public key from private key\n    // The private key in libsodium is actually the seed (32 bytes)\n    // We need to generate the full keypair from it\n    const keypair = sodium.crypto_sign_seed_keypair(privateKey);\n\n    return new IdentityManager(keypair.privateKey, keypair.publicKey);\n  }\n\n  /**\n   * Factory method: Generates a new ephemeral Ed25519 identity in memory.\n   * Matches Python's IdentityManager.generate_ephemeral()\n   */\n  static async generate(): Promise<IdentityManager> {\n    await sodium.ready;\n    const keypair = sodium.crypto_sign_keypair();\n    return new IdentityManager(keypair.privateKey, keypair.publicKey);\n  }\n\n  /**\n   * Legacy method: Loads an identity from a raw private key (Uint8Array).\n   * Kept for backward compatibility.\n   */\n  static async fromPrivateKey(privateKey: Uint8Array): Promise<IdentityManager> {\n    await sodium.ready;\n    // Extract public key from private key\n    const publicKey = (sodium as any).crypto_sign_ed25519_sk_to_pk(privateKey);\n    return new IdentityManager(privateKey, publicKey);\n  }\n\n  /**\n   * Signs a message (string or bytes) and returns the signature in Base64.\n   */\n  async sign(message: string | Uint8Array): Promise<string> {\n    await sodium.ready;\n    const signature = sodium.crypto_sign_detached(message, this.privateKey);\n    return sodium.to_base64(signature, sodium.base64_variants.ORIGINAL);\n  }\n\n  /**\n   * Verifies a signature against a public key.\n   * Static utility for validation.\n   */\n  static async verify(\n    message: string | Uint8Array,\n    signatureBase64: string,\n    publicKey: Uint8Array\n  ): Promise<boolean> {\n    await sodium.ready;\n    try {\n      const signature = sodium.from_base64(signatureBase64, sodium.base64_variants.ORIGINAL);\n      return sodium.crypto_sign_verify_detached(signature, message, publicKey);\n    } catch (e) {\n      return false;\n    }\n  }\n\n  /**\n   * Exports the Public Key to PEM format (PKIX).\n   * Matches Python's serialization.PublicFormat.SubjectPublicKeyInfo\n   */\n  getPublicKeyPem(): string {\n    // Ed25519 OID prefix for SubjectPublicKeyInfo\n    const prefix = new Uint8Array([\n      0x30, 0x2a, // Sequence, length 42\n      0x30, 0x05, // Sequence, length 5\n      0x06, 0x03, 0x2b, 0x65, 0x70, // OID: 1.3.101.112 (Ed25519)\n      0x03, 0x21, 0x00 // Bit String, length 33, 0 padding\n    ]);\n\n    const combined = new Uint8Array(prefix.length + this.publicKey.length);\n    combined.set(prefix);\n    combined.set(this.publicKey, prefix.length);\n\n    const b64 = sodium.to_base64(combined, sodium.base64_variants.ORIGINAL);\n\n    return `-----BEGIN PUBLIC KEY-----\\n${b64}\\n-----END PUBLIC KEY-----\\n`;\n  }\n\n  /**\n   * MCP 1.0: Deterministic Agent ID derivation.\n   * Returns the SHA-256 hash of the public key PEM.\n   * This ensures the ID is cryptographically bound to the key.\n   * Matches Python SDK behavior.\n   */\n  getAgentId(): string {\n    const cleanPem = this.getPublicKeyPem().trim();\n\n    // Try Node.js crypto first\n    if (typeof require !== 'undefined') {\n      try {\n        // eslint-disable-next-line @typescript-eslint/no-var-requires\n        const crypto = require('crypto');\n        return crypto.createHash('sha256').update(cleanPem, 'utf-8').digest('hex');\n      } catch (e) {\n        // Fall through to manual implementation\n      }\n    }\n\n    // For browser environments, we'd need Web Crypto API\n    // For now, throw error as this is primarily for Node.js\n    throw new Error('Agent ID derivation requires Node.js crypto module');\n  }\n\n  /**\n   * Returns the canonical JSON byte representation for signing.\n   * Strict: sort_keys=True, no whitespace.\n   * Matches Python's get_canonical_json_bytes()\n   */\n  static getCanonicalJsonBytes(payload: any): Uint8Array {\n    // Use the same stable stringify as envelope.ts\n    const stringify = require('fast-json-stable-stringify');\n    const jsonStr = stringify(payload);\n    return new TextEncoder().encode(jsonStr);\n  }\n}","/**\n * Amorce Envelope (Task 2.3 - Updated for v0.1.7)\n * Defines the strict AATP v0.1 data structure.\n * Handles canonical serialization and signing.\n * \n * v0.1.7 Updates:\n * - Enhanced error handling with custom exceptions\n * - Better validation\n * \n * NOTE: This module is kept for potential future use and backward compatibility.\n * The current transaction protocol (v0.1.7) uses a flat JSON structure instead\n * of wrapping everything in an envelope.\n */\n\nimport stringify from 'fast-json-stable-stringify';\nimport { v4 as uuidv4 } from 'uuid';\nimport sodium from 'libsodium-wrappers';\nimport { IdentityManager } from './identity';\nimport { AmorceValidationError } from './exceptions';\n\n// Define strict types for priority\nexport type AmorcePriority = 'normal' | 'high' | 'critical';\n\nexport interface SenderInfo {\n  public_key: string; // PEM format\n  agent_id?: string;\n}\n\nexport interface SettlementInfo {\n  amount: number;\n  currency: string;\n  facilitation_fee: number;\n}\n\nexport class AmorceEnvelope {\n  natp_version: string = \"0.1.0\";\n  id: string;\n  priority: AmorcePriority;\n  timestamp: number;\n  sender: SenderInfo;\n  payload: Record<string, any>;\n  settlement: SettlementInfo;\n  signature?: string;\n\n  constructor(\n    sender: SenderInfo,\n    payload: Record<string, any>,\n    priority: AmorcePriority = 'normal'\n  ) {\n    // Validate priority\n    if (!['normal', 'high', 'critical'].includes(priority)) {\n      throw new AmorceValidationError(\n        `Invalid priority: ${priority}. Must be 'normal', 'high', or 'critical'.`\n      );\n    }\n\n    this.id = uuidv4();\n    this.priority = priority;\n    // Python uses float seconds, JS uses ms. Convert to seconds.\n    this.timestamp = Date.now() / 1000;\n    this.sender = sender;\n    this.payload = payload;\n    this.settlement = { amount: 0, currency: 'USD', facilitation_fee: 0 };\n  }\n\n  /**\n   * Returns the canonical JSON bytes of the envelope WITHOUT the signature.\n   */\n  public getCanonicalJson(): Uint8Array {\n    const { signature, ...dataToSign } = this;\n    // fast-json-stable-stringify produces compact JSON (no spaces),\n    // matching Python's separators=(',', ':')\n    const jsonStr = stringify(dataToSign);\n    return new TextEncoder().encode(jsonStr);\n  }\n\n  /**\n   * Signs the envelope using the provided IdentityManager.\n   */\n  public async sign(identity: IdentityManager): Promise<void> {\n    const bytes = this.getCanonicalJson();\n    this.signature = await identity.sign(bytes);\n  }\n\n  /**\n   * Helper to parse a PEM public key back to Uint8Array for verification.\n   * FIX: We must strip the ASN.1 header to get the raw Ed25519 key.\n   */\n  private static pemToBytes(pem: string): Uint8Array {\n    // 1. Clean up the PEM string\n    const b64 = pem\n      .replace('-----BEGIN PUBLIC KEY-----', '')\n      .replace('-----END PUBLIC KEY-----', '')\n      .replace(/\\s/g, '');\n\n    // 2. Decode Base64\n    const fullBytes = sodium.from_base64(b64, sodium.base64_variants.ORIGINAL);\n\n    // 3. Strip ASN.1 Header (Fix)\n    // The SubjectPublicKeyInfo format is 44 bytes total (12 bytes header + 32 bytes key).\n    // Libsodium only wants the raw 32 bytes.\n    if (fullBytes.length > 32) {\n      return fullBytes.slice(fullBytes.length - 32);\n    }\n\n    return fullBytes;\n  }\n\n  /**\n   * Verifies the envelope's signature against its own sender public key.\n   */\n  public async verify(): Promise<boolean> {\n    if (!this.signature) {\n      throw new AmorceValidationError('Envelope has no signature');\n    }\n\n    await sodium.ready;\n\n    try {\n      const canonicalBytes = this.getCanonicalJson();\n      const publicKeyBytes = AmorceEnvelope.pemToBytes(this.sender.public_key);\n\n      return IdentityManager.verify(canonicalBytes, this.signature, publicKeyBytes);\n    } catch (e) {\n      throw new AmorceValidationError(`Verification failed: ${e}`);\n    }\n  }\n}\n\n// DX ALIAS: For simpler imports\nexport const Envelope = AmorceEnvelope;","/**\n * Amorce Client Module (v2.1.0 - Enhanced)\n * High-level HTTP client for the Amorce Agent Transaction Protocol (AATP).\n * \n * v2.1.0 Updates (Feature Parity with Python SDK v0.2.0):\n * - HTTP/2 support via undici\n * - Exponential backoff + jitter via p-retry\n * - Idempotency key generation (UUIDv4)\n * - Structured AmorceResponse return type\n * - Additional headers: X-Amorce-Idempotency, X-Amorce-Agent-ID\n */\n\nimport { request } from 'undici';\nimport pRetry from 'p-retry';\nimport { v4 as uuidv4 } from 'uuid';\nimport { IdentityManager } from './identity';\nimport { AmorcePriority } from './envelope';\nimport { AmorceConfigError, AmorceNetworkError, AmorceAPIError } from './exceptions';\nimport { AmorceResponse, AmorceResponseImpl } from './models';\n\n/**\n * Priority Level constants for easier developer access.\n * Matches Python SDK's PriorityLevel class.\n */\nexport class PriorityLevel {\n  static readonly NORMAL: AmorcePriority = 'normal';\n  static readonly HIGH: AmorcePriority = 'high';\n  static readonly CRITICAL: AmorcePriority = 'critical';\n}\n\nexport interface ServiceContract {\n  service_id: string;\n  provider_agent_id?: string;\n  service_type?: string;\n  [key: string]: any;\n}\n\nexport class AmorceClient {\n  private identity: IdentityManager;\n  private directoryUrl: string;\n  private orchestratorUrl: string;\n  private agentId: string;\n  private apiKey?: string;\n\n  constructor(\n    identity: IdentityManager,\n    directoryUrl: string,\n    orchestratorUrl: string,\n    agentId?: string,\n    apiKey?: string\n  ) {\n    this.identity = identity;\n\n    // Validate URLs\n    if (!directoryUrl.startsWith('http://') && !directoryUrl.startsWith('https://')) {\n      throw new AmorceConfigError(`Invalid directory_url: ${directoryUrl}`);\n    }\n    if (!orchestratorUrl.startsWith('http://') && !orchestratorUrl.startsWith('https://')) {\n      throw new AmorceConfigError(`Invalid orchestrator_url: ${orchestratorUrl}`);\n    }\n\n    // Remove trailing slashes for consistency\n    this.directoryUrl = directoryUrl.replace(/\\/$/, '');\n    this.orchestratorUrl = orchestratorUrl.replace(/\\/$/, '');\n\n    // Auto-derive Agent ID from identity\n    this.agentId = agentId || identity.getAgentId();\n    this.apiKey = apiKey;\n  }\n\n  /**\n   * Discover services from the Trust Directory.\n   * Uses p-retry for exponential backoff with jitter.\n   */\n  public async discover(serviceType: string): Promise<ServiceContract[]> {\n    const url = `${this.directoryUrl}/api/v1/services/search?service_type=${encodeURIComponent(serviceType)}`;\n\n    try {\n      const response = await pRetry(\n        async () => {\n          const res = await request(url, {\n            method: 'GET',\n            headers: {\n              'Content-Type': 'application/json'\n            }\n          });\n\n          // Check for retryable status codes\n          if ([429, 503, 504].includes(res.statusCode)) {\n            throw new Error(`Retryable status: ${res.statusCode}`);\n          }\n\n          if (res.statusCode !== 200) {\n            const errorText = await res.body.text();\n            throw new AmorceAPIError(\n              `Discovery API error: ${res.statusCode}`,\n              res.statusCode,\n              errorText\n            );\n          }\n\n          return res;\n        },\n        {\n          retries: 3,\n          minTimeout: 1000,\n          maxTimeout: 10000,\n          randomize: true,  // Adds jitter to prevent thundering herd\n          onFailedAttempt: (error) => {\n            console.warn(`Discovery retry attempt ${error.attemptNumber}: ${error.message}`);\n          }\n        }\n      );\n\n      return await response.body.json() as ServiceContract[];\n    } catch (e) {\n      if (e instanceof AmorceAPIError) {\n        throw e;\n      }\n      throw new AmorceNetworkError(`Discovery network error: ${e}`);\n    }\n  }\n\n  /**\n   * Execute a transaction via the Orchestrator.\n   * \n   * v2.1.0 Enhancements:\n   * - HTTP/2 via undici (automatic for https://)\n   * - Exponential backoff + jitter via p-retry\n   * - Idempotency key auto-generation\n   * - Returns AmorceResponse with utility methods\n   * \n   * @param serviceContract - Service identifier (must contain service_id)\n   * @param payload - Transaction payload\n   * @param priority - Priority level (normal|high|critical)\n   * @param idempotencyKey - Optional idempotency key (auto-generated if not provided)\n   * @returns AmorceResponse with transaction details\n   */\n  public async transact(\n    serviceContract: ServiceContract,\n    payload: Record<string, any>,\n    priority: AmorcePriority = PriorityLevel.NORMAL,\n    idempotencyKey?: string\n  ): Promise<AmorceResponse> {\n    if (!serviceContract.service_id) {\n      throw new AmorceConfigError('Invalid service contract: missing service_id');\n    }\n\n    // AUTO-GENERATE IDEMPOTENCY KEY (v2.1.0)\n    const key = idempotencyKey || uuidv4();\n\n    // Build flat JSON body\n    const requestBody = {\n      service_id: serviceContract.service_id,\n      consumer_agent_id: this.agentId,\n      payload: payload,\n      priority: priority\n    };\n\n    // Sign the canonical request body\n    const canonicalBytes = IdentityManager.getCanonicalJsonBytes(requestBody);\n    const signature = await this.identity.sign(canonicalBytes);\n\n    // Construct headers with ALL required fields\n    const headers: Record<string, string> = {\n      'X-Agent-Signature': signature,\n      'X-Amorce-Idempotency': key,           // NEW in v2.1.0\n      'X-Amorce-Agent-ID': this.agentId,     // NEW in v2.1.0\n      'Content-Type': 'application/json'\n    };\n\n    if (this.apiKey) {\n      headers['X-API-Key'] = this.apiKey;\n    }\n\n    const url = `${this.orchestratorUrl}/v1/a2a/transact`;\n\n    try {\n      // Execute with p-retry (exponential backoff + jitter)\n      const response = await pRetry(\n        async () => {\n          const res = await request(url, {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(requestBody)\n            // undici uses HTTP/2 by default for https:// URLs\n          });\n\n          // Retry on specific status codes\n          if ([429, 503, 504].includes(res.statusCode)) {\n            throw new Error(`Retryable status: ${res.statusCode}`);\n          }\n\n          // Non-retryable client errors (4xx except 429)\n          if (res.statusCode >= 400 && res.statusCode < 500 && res.statusCode !== 429) {\n            const errorText = await res.body.text();\n            throw new AmorceAPIError(\n              `Transaction failed with status ${res.statusCode}`,\n              res.statusCode,\n              errorText\n            );\n          }\n\n          // Server errors (5xx)\n          if (res.statusCode >= 500) {\n            throw new Error(`Server error: ${res.statusCode}`);\n          }\n\n          return res;\n        },\n        {\n          retries: 3,\n          minTimeout: 1000,    // 1s\n          maxTimeout: 10000,   // 10s\n          randomize: true,     // Adds 0-2s jitter\n          onFailedAttempt: (error) => {\n            console.warn(`Transaction retry attempt ${error.attemptNumber}: ${error.message}`);\n          }\n        }\n      );\n\n      // Parse response and build AmorceResponse\n      const jsonData = await response.body.json() as any;\n\n      return new AmorceResponseImpl(\n        jsonData.transaction_id || key,\n        response.statusCode,\n        {\n          status: jsonData.status || 'success',\n          message: jsonData.message,\n          data: jsonData.data\n        },\n        undefined  // No error for successful responses\n      );\n\n    } catch (e) {\n      if (e instanceof AmorceAPIError) {\n        throw e;\n      }\n      throw new AmorceNetworkError(`Transaction network error: ${e}`);\n    }\n  }\n}","/**\n * Amorce Response Models Module\n * TypeScript interfaces and classes for structured responses.\n * Matches Python SDK's Pydantic models for consistency.\n */\n\n/**\n * Configuration for Amorce clients.\n */\nexport interface AmorceConfig {\n    directoryUrl: string;\n    orchestratorUrl: string;\n}\n\n/**\n * Nested result data from a successful transaction.\n */\nexport interface TransactionResult {\n    status: string;\n    message?: string;\n    data?: Record<string, any>;\n}\n\n/**\n * Standardized response wrapper for transact() operations.\n * Provides consistent interface across sync and async implementations.\n */\nexport interface AmorceResponse {\n    transaction_id: string;\n    status_code: number;\n    result?: TransactionResult;\n    error?: string;\n\n    /**\n     * Check if transaction was successful (2xx status)\n     */\n    isSuccess(): boolean;\n\n    /**\n     * Check if error is retryable (5xx or 429)\n     */\n    isRetryable(): boolean;\n}\n\n/**\n * Concrete implementation of AmorceResponse.\n */\nexport class AmorceResponseImpl implements AmorceResponse {\n    constructor(\n        public transaction_id: string,\n        public status_code: number,\n        public result?: TransactionResult,\n        public error?: string\n    ) { }\n\n    isSuccess(): boolean {\n        return this.status_code >= 200 && this.status_code < 300;\n    }\n\n    isRetryable(): boolean {\n        return [429, 500, 502, 503, 504].includes(this.status_code);\n    }\n}\n"],"mappings":"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","names":["sodium","sodium","stringify","import_libsodium_wrappers","uuidv4","stringify","sodium","import_uuid","pRetry","uuidv4"]}